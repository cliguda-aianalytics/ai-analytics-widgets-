<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLV Analysis Widget</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: transparent;
            overflow-x: hidden;
        }
        
        /* Custom Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            transition: background 0.3s ease;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Firefox Scrollbar */
        * {
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.2) rgba(255, 255, 255, 0.05);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Lucide Icons as SVG components
        const AlertTriangle = () => (
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
                <line x1="12" y1="9" x2="12" y2="13"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
        );
        
        const TrendingDown = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="22 17 13.5 8.5 8.5 13.5 2 7"/>
                <polyline points="16 17 22 17 22 11"/>
            </svg>
        );
        
        const Euro = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M4 10h12"/>
                <path d="M4 14h9"/>
                <path d="M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2"/>
            </svg>
        );
        
        const PieChart = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21.21 15.89A10 10 0 1 1 8 2.83"/>
                <path d="M22 12A10 10 0 0 0 12 2v10z"/>
            </svg>
        );
        
        const Calculator = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="4" y="2" width="16" height="20" rx="2"/>
                <line x1="8" y1="6" x2="16" y2="6"/>
                <line x1="8" y1="10" x2="16" y2="10"/>
                <line x1="8" y1="14" x2="10" y2="14"/>
                <line x1="14" y1="14" x2="16" y2="14"/>
                <line x1="8" y1="18" x2="10" y2="18"/>
                <line x1="14" y1="18" x2="16" y2="18"/>
            </svg>
        );

        function CLVAnalysisWidget() {
            const [animationStep, setAnimationStep] = useState(0);
            const [showRealValues, setShowRealValues] = useState(false);

            useEffect(() => {
                const interval = setInterval(() => {
                    setAnimationStep((prev) => (prev + 1) % 5);
                }, 2000);
                return () => clearInterval(interval);
            }, []);

            useEffect(() => {
                const realValueTimer = setTimeout(() => {
                    setShowRealValues(true);
                }, 6000);
                return () => clearTimeout(realValueTimer);
            }, []);

            // Beispieldaten für die Visualisierung
            const nordData = {
                totalCustomers: 10000,
                normalCustomers: 8000,
                prospects: 2000, // -1 values
                avgWithSpecial: "3.440€",
                avgWithoutSpecial: "4.300€",
                fakeAvg: "3.4k€",
                realAvg: "4.3k€"
            };

            const suedData = {
                totalCustomers: 8000,
                normalCustomers: 7999,
                enterpriseCustomers: 1, // 999999 values
                avgWithSpecial: "4.025€",
                avgWithoutSpecial: "3.900€",
                fakeAvg: "4.0k€",
                realAvg: "3.9k€"
            };

            return (
                <div className="bg-gradient-to-br from-gray-900 to-gray-800" style={{background: 'linear-gradient(to bottom right, #1a202c, #2d3748)'}}>
                    <div className="p-6 text-white max-w-2xl mx-auto">
                        {/* Header */}
                        <div className="flex items-center gap-3 mb-4">
                            <div className="p-2 bg-red-500 bg-opacity-20 rounded-lg">
                                <div className="text-red-400" style={{transform: 'scale(0.8)'}}>
                                    <AlertTriangle />
                                </div>
                            </div>
                            <div>
                                <h2 className="text-xl font-bold">CLV-Analyse Disaster</h2>
                                <p className="text-gray-400 text-sm">Marketing-Budget Fehlallokation</p>
                            </div>
                        </div>

                        {/* Scenario */}
                        <div className="bg-gray-800 bg-opacity-50 rounded-lg p-4 mb-4 border border-gray-700">
                            <h3 className="text-base font-semibold mb-2 flex items-center gap-2">
                                <div className="text-blue-400">
                                    <PieChart />
                                </div>
                                Szenario
                            </h3>
                            <div className="space-y-2 text-sm">
                                <p>• <span className="text-gray-400">Aufgabe:</span> Kundensegmentierung für Marketing-Budget 2025</p>
                                <p>• <span className="text-gray-400">Daten:</span> Customer Lifetime Value (CLV) pro Kunde</p>
                                <p>• <span className="text-gray-400">Methode:</span> Durchschnittlicher CLV pro Region</p>
                            </div>
                        </div>

                        {/* Special Values Info */}
                        <div className={`bg-yellow-500 bg-opacity-10 rounded-lg p-3 mb-4 border transition-all duration-500 ${
                            animationStep >= 1 ? 'border-yellow-500 shadow-lg' : 'border-yellow-500 border-opacity-30'
                        }`} style={{boxShadow: animationStep >= 1 ? '0 10px 15px -3px rgba(245, 158, 11, 0.2)' : 'none'}}>
                            <h4 className="font-semibold text-yellow-400 mb-1 flex items-center gap-2 text-sm">
                                <Calculator />
                                Versteckte Special Values im Datensatz
                            </h4>
                            <div className="text-sm space-y-1 font-mono">
                                <p><span className="text-red-400">-1</span> = "Interessent, noch nie gekauft"</p>
                                <p><span className="text-green-400">999.999€</span> = "Enterprise-Kunde mit Sondervertrag"</p>
                            </div>
                        </div>

                        {/* The Problem */}
                        <div className="grid grid-cols-2 gap-3 mb-4">
                            <div className={`bg-blue-500 bg-opacity-10 rounded-lg p-3 border transition-all duration-500 ${
                                animationStep >= 2 ? 'border-blue-500 shadow-lg' : 'border-blue-500 border-opacity-30'
                            }`} style={{boxShadow: animationStep >= 2 ? '0 10px 15px -3px rgba(59, 130, 246, 0.2)' : 'none'}}>
                                <h4 className="font-semibold text-blue-400 mb-2">Region Nord</h4>
                                <div className="text-sm space-y-1">
                                    <p className="text-gray-300">{nordData.totalCustomers.toLocaleString()} Kunden gesamt</p>
                                    <p className="text-red-400">• {nordData.prospects.toLocaleString()} Interessenten (-1)</p>
                                    <div className="mt-2 pt-2 border-t border-blue-500 border-opacity-30">
                                        <p className="text-xs text-gray-400">Naiver Durchschnitt:</p>
                                        <p className="font-bold text-lg text-red-400">{nordData.fakeAvg}</p>
                                    </div>
                                </div>
                            </div>

                            <div className={`bg-purple-500 bg-opacity-10 rounded-lg p-3 border transition-all duration-500 ${
                                animationStep >= 3 ? 'border-purple-500 shadow-lg' : 'border-purple-500 border-opacity-30'
                            }`} style={{boxShadow: animationStep >= 3 ? '0 10px 15px -3px rgba(139, 92, 246, 0.2)' : 'none'}}>
                                <h4 className="font-semibold text-purple-400 mb-2">Region Süd</h4>
                                <div className="text-sm space-y-1">
                                    <p className="text-gray-300">{suedData.totalCustomers.toLocaleString()} Kunden gesamt</p>
                                    <p className="text-green-400">• {suedData.enterpriseCustomers} Enterprise-Kunde (999k€)</p>
                                    <div className="mt-2 pt-2 border-t border-purple-500 border-opacity-30">
                                        <p className="text-xs text-gray-400">Naiver Durchschnitt:</p>
                                        <p className="font-bold text-lg text-green-400">{suedData.fakeAvg}</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* False Decision */}
                        <div className={`bg-red-500 bg-opacity-10 rounded-lg p-3 border border-red-500 border-opacity-30 transition-all duration-500 ${
                            animationStep >= 4 ? 'animate-pulse' : ''
                        }`}>
                            <h3 className="text-base font-semibold mb-2 text-red-400 flex items-center gap-2">
                                <TrendingDown />
                                Fatale Fehlentscheidung
                            </h3>
                            <div className="space-y-3">
                                <div className="flex justify-between items-center">
                                    <span className="text-sm">Marketing-Budget Shift:</span>
                                    <span className="text-lg font-bold text-red-400">Nord → Süd</span>
                                </div>
                                {showRealValues && (
                                    <div className="pt-3 border-t border-red-500 border-opacity-30">
                                        <p className="text-xs text-gray-400 mb-1">Tatsächliche Durchschnitte (ohne Special Values):</p>
                                        <div className="grid grid-cols-2 gap-2 text-sm">
                                            <div>Nord: <span className="text-green-400 font-bold">{nordData.realAvg}</span></div>
                                            <div>Süd: <span className="text-orange-400 font-bold">{suedData.realAvg}</span></div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Consequences */}
                        <div className="mt-4 space-y-2">
                            <h3 className="text-base font-semibold flex items-center gap-2">
                                <div className="text-yellow-400">
                                    <Euro />
                                </div>
                                Konsequenzen nach 6 Monaten
                            </h3>
                            <div className="space-y-2 text-sm">
                                <div className="flex items-center gap-3">
                                    <div className="w-2 h-2 bg-red-400 rounded-full animate-pulse" />
                                    <p><span className="text-red-400 font-semibold">500.000€</span> Marketing-Budget falsch allokiert</p>
                                </div>
                                <div className="flex items-center gap-3">
                                    <div className="w-2 h-2 bg-red-400 rounded-full animate-pulse" />
                                    <p><span className="text-red-400 font-semibold">-15%</span> Neukundengewinnung in Region Nord</p>
                                </div>
                                <div className="flex items-center gap-3">
                                    <div className="w-2 h-2 bg-red-400 rounded-full animate-pulse" />
                                    <p><span className="text-red-400 font-semibold">1 Enterprise-Kunde</span> verzerrt gesamte Strategie</p>
                                </div>
                                <div className="flex items-center gap-3">
                                    <div className="w-2 h-2 bg-red-400 rounded-full animate-pulse" />
                                    <p><span className="text-red-400 font-semibold">Beste Region</span> wird systematisch vernachlässigt</p>
                                </div>
                            </div>
                        </div>

                        {/* Root Cause */}
                        <div className="mt-4 bg-yellow-500 bg-opacity-10 rounded-lg p-3 border border-yellow-500 border-opacity-30">
                            <p className="text-sm">
                                <span className="font-semibold text-yellow-400">Root Cause:</span> Special Values werden nicht erkannt und behandelt. 
                                Naive Durchschnitte führen zu falschen Business-Entscheidungen!
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        // Render the component
        ReactDOM.render(<CLVAnalysisWidget />, document.getElementById('root'));
    </script>
</body>
</html>